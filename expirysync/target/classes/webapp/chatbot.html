<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExpirySync - AI Assistant</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dsa.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #0077cc;
            --secondary: #00a8ff;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --purple: #6f42c1;
            --text: #333333;
            --light-bg: #f8f9fa;
            --border: #dee2e6;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 250px;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            z-index: 100;
            display: flex;
            flex-direction: column;
        }
        
        .logo {
            padding: 25px 20px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }
        
        .logo h1 {
            margin: 0;
            font-size: 1.5rem;
            color: var(--primary);
        }
        
        .nav-menu {
            padding: 20px 0;
            flex: 1;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--text);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }
        
        .nav-item:hover {
            background: var(--light-bg);
            color: var(--primary);
        }
        
        .nav-item.active {
            background: var(--light-bg);
            color: var(--primary);
            border-left-color: var(--primary);
        }
        
        .nav-item i {
            width: 24px;
            margin-right: 10px;
        }
        
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        /* Chat Container */
        .chat-container {
            display: flex;
            height: calc(100vh - 40px);
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .chat-sidebar {
            width: 300px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .chat-header {
            padding: 20px 25px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 15px;
            background: white;
            z-index: 10;
        }
        
        .chat-messages {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: #f8f9fa;
        }
        
        .chat-input-container {
            padding: 20px 25px;
            border-top: 1px solid #eee;
            background: white;
            z-index: 10;
        }
        
        /* Message Styles */
        .message {
            max-width: 85%;
            padding: 15px 18px;
            border-radius: 15px;
            position: relative;
            animation: messageSlide 0.3s ease;
            line-height: 1.5;
            word-wrap: break-word;
        }
        
        .message.user {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        
        .message.bot {
            background: white;
            color: var(--text);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-left: 3px solid var(--primary);
        }
        
        .message.bot.dsa {
            border-left-color: var(--purple);
            background: linear-gradient(to right, #f8f9fa, white);
        }
        
        .message.bot.warning {
            border-left-color: var(--warning);
            background: #fff3cd;
        }
        
        .message.bot.error {
            border-left-color: var(--danger);
            background: #f8d7da;
        }
        
        .message.bot.success {
            border-left-color: var(--success);
            background: #d4edda;
        }
        
        .message-time {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 8px;
            display: block;
            text-align: right;
        }
        
        /* Quick Questions */
        .quick-questions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .quick-question {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .quick-question:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }
        
        /* DSA Demo Section */
        .dsa-demo-section {
            background: linear-gradient(135deg, #6f42c1, #8e44ad);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .dsa-demo-controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 15px 20px;
            background: white;
            border-radius: 15px;
            align-self: flex-start;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            max-width: 150px;
            border-left: 3px solid var(--primary);
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        /* Chat Input */
        .chat-input {
            display: flex;
            gap: 10px;
        }
        
        .chat-input textarea {
            flex: 1;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            resize: none;
            font-family: inherit;
            font-size: 0.95rem;
            transition: all 0.3s;
            max-height: 120px;
            line-height: 1.4;
        }
        
        .chat-input textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 119, 200, 0.1);
        }
        
        .send-button {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 119, 200, 0.2);
        }
        
        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Code Preview */
        .dsa-code-preview {
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            line-height: 1.4;
        }
        
        .dsa-code-preview .keyword { color: #ff79c6; }
        .dsa-code-preview .type { color: #8be9fd; }
        .dsa-code-preview .string { color: #f1fa8c; }
        .dsa-code-preview .comment { color: #6272a4; font-style: italic; }
        .dsa-code-preview .function { color: #50fa7b; }
        .dsa-code-preview .number { color: #bd93f9; }
        .dsa-code-preview .operator { color: #ff79c6; }
        
        /* Message Actions */
        .message-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
            background: #f1f3f5;
            color: #495057;
        }
        
        .action-btn.code {
            background: #6f42c1;
            color: white;
        }
        
        .action-btn.demo {
            background: #f59e0b;
            color: white;
        }
        
        .action-btn.info {
            background: #3b82f6;
            color: white;
        }
        
        .action-btn.copy {
            background: #10b981;
            color: white;
        }
        
        .action-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        /* Product List in Messages */
        .product-list {
            margin: 10px 0;
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 8px;
            background: white;
        }
        
        .product-item {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }
        
        .product-item:hover {
            background: #f8f9fa;
        }
        
        .product-item:last-child {
            border-bottom: none;
        }
        
        .product-item-info {
            flex: 1;
        }
        
        .product-item-name {
            font-weight: 500;
            color: var(--text);
            margin-bottom: 3px;
        }
        
        .product-item-meta {
            font-size: 0.85rem;
            color: #666;
            display: flex;
            gap: 10px;
        }
        
        .product-item-priority {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            color: white;
        }
        
        .priority-0 { background: #ef4444; }
        .priority-1 { background: #f97316; }
        .priority-2 { background: #f59e0b; }
        .priority-3 { background: #3b82f6; }
        .priority-4 { background: #10b981; }
        
        /* Complexity Badges */
        .complexity-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin: 0 5px 2px 0;
            color: white;
        }
        
        .badge-O1 { background: #10b981; }
        .badge-Ologn { background: #f59e0b; }
        .badge-On { background: #ef4444; }
        .badge-On2 { background: #8b5cf6; }
        
        /* Chat History */
        .chat-history {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .history-item {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .history-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* DSA Structure Info */
        .dsa-structure-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .dsa-structure-info h5 {
            margin: 0 0 10px 0;
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Voice Input */
        .voice-input-container {
            position: relative;
            margin-bottom: 10px;
        }
        
        .voice-input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        .voice-input-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        /* Suggested Questions */
        .suggested-questions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
            padding: 0 25px 10px;
        }
        
        .suggested-question {
            padding: 6px 12px;
            background: #e9ecef;
            border-radius: 15px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid transparent;
        }
        
        .suggested-question:hover {
            background: #dee2e6;
            transform: translateY(-1px);
            border-color: var(--primary);
        }
        
        /* Welcome Animation */
        .welcome-animation {
            text-align: center;
            padding: 20px;
            animation: fadeIn 1s ease;
        }
        
        .welcome-animation i {
            font-size: 3rem;
            color: white;
            margin-bottom: 15px;
            animation: bounce 2s infinite;
        }
        
        /* Button Styles */
        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: 1px solid transparent;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.3s;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
        }
        
        .btn-xs {
            padding: 4px 8px;
            font-size: 0.75rem;
        }
        
        .btn-outline-primary {
            background: white;
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .btn-outline-primary:hover {
            background: var(--primary);
            color: white;
        }
        
        .btn-outline-secondary {
            background: white;
            border-color: #6c757d;
            color: #6c757d;
        }
        
        .btn-outline-secondary:hover {
            background: #6c757d;
            color: white;
        }
        
        .btn-outline-success {
            background: white;
            border-color: var(--success);
            color: var(--success);
        }
        
        .btn-outline-success:hover {
            background: var(--success);
            color: white;
        }
        
        .text-primary { color: var(--primary); }
        .text-warning { color: var(--warning); }
        .text-danger { color: var(--danger); }
        .text-purple { color: var(--purple); }
        .text-muted { color: #6c757d; }
        
        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes typing {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* Responsive Design */
        @media (max-width: 992px) {
            .chat-container {
                flex-direction: column;
                height: calc(100vh - 20px);
            }
            
            .chat-sidebar {
                width: 100%;
                height: 300px;
                order: 2;
            }
            
            .chat-main {
                order: 1;
                flex: 1;
            }
            
            .dsa-demo-controls {
                grid-template-columns: 1fr;
            }
            
            .message {
                max-width: 90%;
            }
            
            .sidebar {
                width: 70px;
            }
            
            .nav-item span {
                display: none;
            }
            
            .logo h1 {
                font-size: 1rem;
            }
        }
        
        @media (max-width: 576px) {
            .chat-header {
                padding: 15px;
                flex-wrap: wrap;
            }
            
            .chat-messages {
                padding: 15px;
            }
            
            .chat-input-container {
                padding: 15px;
            }
            
            .message {
                max-width: 95%;
                padding: 12px 15px;
            }
            
            .message-actions {
                gap: 5px;
            }
            
            .action-btn {
                padding: 5px 10px;
                font-size: 0.75rem;
            }
            
            .sidebar {
                display: none;
            }
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <h1><i class="fas fa-shield-alt"></i> ExpirySync</h1>
                <small class="text-muted">AI Assistant</small>
            </div>
            
            <nav class="nav-menu">
                <a href="dashboard.html" class="nav-item">
                    <i class="fas fa-home"></i> <span>Dashboard</span>
                </a>
                <a href="inventory.html" class="nav-item">
                    <i class="fas fa-boxes"></i> <span>Inventory</span>
                </a>
                <a href="add-product.html" class="nav-item">
                    <i class="fas fa-plus-circle"></i> <span>Add Product</span>
                </a>
                <a href="alerts.html" class="nav-item">
                    <i class="fas fa-bell"></i> <span>Alerts</span>
                </a>
                <a href="chatbot.html" class="nav-item active">
                    <i class="fas fa-robot"></i> <span>AI Assistant</span>
                </a>
                <a href="dsa-demo.html" class="nav-item">
                    <i class="fas fa-project-diagram"></i> <span>DSA Demo</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content" style="padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <div class="chat-container">
                <!-- Sidebar -->
                <div class="chat-sidebar">
                    <div class="welcome-animation">
                        <i class="fas fa-robot"></i>
                        <h3 style="margin: 0 0 5px 0; color: white;">ExpirySync AI</h3>
                        <p style="opacity: 0.8; font-size: 0.9rem; color: rgba(255,255,255,0.8);">Your DSA-powered inventory assistant</p>
                    </div>
                    
                    <div style="flex: 1;">
                        <h4 style="font-size: 1rem; margin-bottom: 15px; color: white;">
                            <i class="fas fa-bolt"></i> Quick Questions
                        </h4>
                        <div class="quick-questions">
                            <div class="quick-question" onclick="askQuestion('Which products are expiring this week?')">
                                <i class="fas fa-clock"></i>
                                <span>Expiring this week?</span>
                            </div>
                            <div class="quick-question" onclick="askQuestion('Show me low stock items')">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>Low stock items</span>
                            </div>
                            <div class="quick-question" onclick="askQuestion('What is the most urgent product?')">
                                <i class="fas fa-fire"></i>
                                <span>Most urgent product</span>
                            </div>
                            <div class="quick-question" onclick="askQuestion('How many dairy products do we have?')">
                                <i class="fas fa-cheese"></i>
                                <span>Dairy products count</span>
                            </div>
                            <div class="quick-question" onclick="askQuestion('Which products need discounts?')">
                                <i class="fas fa-percentage"></i>
                                <span>Discount suggestions</span>
                            </div>
                            <div class="quick-question" onclick="askQuestion('Show recent additions')">
                                <i class="fas fa-history"></i>
                                <span>Recent additions</span>
                            </div>
                        </div>
                        
                        <div class="dsa-structure-info">
                            <h5><i class="fas fa-project-diagram"></i> DSA Structures</h5>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 0.85rem;">
                                <div>
                                    <i class="fas fa-layer-group"></i> Stack
                                    <div class="complexity-badge badge-O1">O(1)</div>
                                </div>
                                <div>
                                    <i class="fas fa-stream"></i> Queue
                                    <div class="complexity-badge badge-O1">O(1)</div>
                                </div>
                                <div>
                                    <i class="fas fa-sort-amount-up"></i> Priority Q
                                    <div class="complexity-badge badge-Ologn">O(log n)</div>
                                </div>
                                <div>
                                    <i class="fas fa-sort"></i> Sorting
                                    <div class="complexity-badge badge-Ologn">O(n log n)</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dsa-demo-section">
                        <h4 style="font-size: 1rem; margin-bottom: 10px; color: white;">
                            <i class="fas fa-play-circle"></i> DSA Demos
                        </h4>
                        <div class="dsa-demo-controls">
                            <button class="btn btn-sm" style="background: white; color: #6f42c1;" 
                                    onclick="demoDSAOperation('stack')">
                                <i class="fas fa-layer-group"></i> Stack
                            </button>
                            <button class="btn btn-sm" style="background: white; color: #6f42c1;" 
                                    onclick="demoDSAOperation('queue')">
                                <i class="fas fa-stream"></i> Queue
                            </button>
                            <button class="btn btn-sm" style="background: white; color: #6f42c1;" 
                                    onclick="demoDSAOperation('priority')">
                                <i class="fas fa-sort-amount-up"></i> Priority Q
                            </button>
                            <button class="btn btn-sm" style="background: white; color: #6f42c1;" 
                                    onclick="demoDSAOperation('sort')">
                                <i class="fas fa-sort"></i> Sort
                            </button>
                        </div>
                    </div>
                    
                    <div class="chat-history">
                        <h4 style="font-size: 1rem; margin-bottom: 10px; color: white;">
                            <i class="fas fa-history"></i> Recent Queries
                        </h4>
                        <div id="history-list">
                            <!-- History will be loaded here -->
                        </div>
                        <button onclick="clearHistory()" style="width: 100%; margin-top: 10px; padding: 8px; 
                                background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); 
                                color: white; border-radius: 6px; cursor: pointer; transition: all 0.3s;"
                                onmouseover="this.style.background='rgba(255,255,255,0.2)'"
                                onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                            <i class="fas fa-trash"></i> Clear History
                        </button>
                    </div>
                </div>
                
                <!-- Chat Main Area -->
                <div class="chat-main">
                    <!-- Chat Header -->
                    <div class="chat-header">
                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, var(--primary), var(--secondary)); 
                                  border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div style="flex: 1;">
                            <h3 style="margin: 0; font-size: 1.2rem; color: var(--text);">ExpirySync AI Assistant</h3>
                            <p style="margin: 0; color: #666; font-size: 0.9rem;">
                                Ask about inventory, expiry dates, or DSA concepts
                            </p>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-sm btn-outline-secondary" onclick="clearChat()">
                                <i class="fas fa-trash"></i> Clear
                            </button>
                            <button class="btn btn-sm btn-outline-primary" onclick="showHelp()">
                                <i class="fas fa-question-circle"></i> Help
                            </button>
                            <button class="btn btn-sm btn-outline-success" onclick="toggleVoiceInput()" id="voice-btn">
                                <i class="fas fa-microphone"></i> Voice
                            </button>
                        </div>
                    </div>
                    
                    <!-- Voice Input (hidden by default) -->
                    <div id="voice-input-container" class="voice-input-container" style="display: none; margin: 0 25px;">
                        <input type="text" id="voice-input" class="voice-input" placeholder="Speak your question...">
                        <button class="voice-input-btn" onclick="toggleVoiceInput()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <!-- Chat Messages -->
                    <div class="chat-messages" id="chat-messages">
                        <!-- Welcome Message -->
                        <div class="message bot">
                            <strong>ü§ñ ExpirySync AI:</strong> Hello! I'm your AI assistant powered by Data Structures and Algorithms. I can help you with:
                            <br><br>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 10px 0;">
                                <div><i class="fas fa-box text-primary"></i> Inventory queries</div>
                                <div><i class="fas fa-clock text-warning"></i> Expiry tracking</div>
                                <div><i class="fas fa-bell text-danger"></i> Alert management</div>
                                <div><i class="fas fa-project-diagram text-purple"></i> DSA explanations</div>
                            </div>
                            <br>
                            Try asking me something or click a quick question!
                            <div class="message-actions">
                                <button class="action-btn code" onclick="showCodeExample('stack')">
                                    <i class="fas fa-code"></i> Stack Code
                                </button>
                                <button class="action-btn demo" onclick="demoDSAOperation('stack')">
                                    <i class="fas fa-play"></i> Stack Demo
                                </button>
                                <button class="action-btn info" onclick="askQuestion('What is time complexity?')">
                                    <i class="fas fa-info-circle"></i> Time Complexity
                                </button>
                            </div>
                            <span class="message-time">Just now</span>
                        </div>
                    </div>
                    
                    <!-- Suggested Questions -->
                    <div id="suggested-questions" class="suggested-questions" style="display: none;">
                        <strong style="font-size: 0.9rem; color: #666; margin-right: 10px;">Try asking:</strong>
                        <!-- Suggestions will be added here -->
                    </div>
                    
                    <!-- Typing Indicator -->
                    <div class="typing-indicator" id="typing-indicator" style="display: none;">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <span style="margin-left: 10px; color: #666;">AI is thinking...</span>
                    </div>
                    
                    <!-- Chat Input -->
                    <div class="chat-input-container">
                        <div class="chat-input">
                            <textarea id="chat-input" placeholder="Type your question about inventory or DSA operations..." 
                                      rows="1" onkeydown="handleKeyPress(event)"></textarea>
                            <button class="send-button" id="send-button" onclick="sendMessage()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        <div style="margin-top: 10px; display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-xs btn-outline-secondary" onclick="insertCodeTemplate()">
                                    <i class="fas fa-code"></i> Code Template
                                </button>
                                <button class="btn btn-xs btn-outline-secondary" onclick="showExamples()">
                                    <i class="fas fa-lightbulb"></i> Examples
                                </button>
                            </div>
                            <small style="color: #666;">
                                <span id="char-count">0</span>/500
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- JavaScript -->
    <script src="js/storage.js"></script>
    <script src="js/api-simulator.js"></script>
    <script>
        // Chat state
        let chatHistory = [];
        let queryHistory = [];
        let isProcessing = false;
        let voiceEnabled = false;
        let recognition = null;
        let currentSuggestions = [];
        
        // Knowledge base
        const knowledgeBase = {
            'expiring': [
                'Which products are expiring this week?',
                'What expires in the next 3 days?',
                'Show me products expiring soon',
                'Urgent expiry alerts'
            ],
            'stock': [
                'Show low stock items',
                'Which products need restocking?',
                'Inventory below 10 units',
                'Critical stock levels'
            ],
            'category': [
                'How many dairy products?',
                'List all bakery items',
                'Count products by category',
                'Category distribution'
            ],
            'dsa': [
                'Explain stack data structure',
                'What is a priority queue?',
                'Time complexity examples',
                'DSA implementation in Java'
            ],
            'recent': [
                'Show recent additions',
                'Last added products',
                'New inventory items',
                'Recent product updates'
            ]
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            // Load chat history
            loadChatHistory();
            
            // Load query history
            loadQueryHistory();
            
            // Set up character counter
            setupTextArea();
            
            // Initialize voice recognition
            initVoiceRecognition();
            
            // Focus on input
            document.getElementById('chat-input').focus();
            
            // Show welcome suggestions
            showWelcomeSuggestions();
        });
        
        function loadChatHistory() {
            const savedHistory = localStorage.getItem('expirysync_chat_history');
            if (savedHistory) {
                try {
                    chatHistory = JSON.parse(savedHistory);
                    
                    // Display chat history
                    const container = document.getElementById('chat-messages');
                    container.innerHTML = '';
                    
                    // Always show welcome message first
                    addWelcomeMessage();
                    
                    // Add history messages
                    chatHistory.forEach(msg => {
                        addMessageToUI(msg.text, msg.sender, msg.isDSA, false);
                    });
                } catch (e) {
                    console.error('Error loading chat history:', e);
                    chatHistory = [];
                    addWelcomeMessage();
                }
            } else {
                addWelcomeMessage();
            }
        }
        
        function addWelcomeMessage() {
            const welcomeHTML = `
                <strong>ü§ñ ExpirySync AI:</strong> Hello! I'm your AI assistant powered by Data Structures and Algorithms. I can help you with:
                <br><br>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 10px 0;">
                    <div><i class="fas fa-box text-primary"></i> Inventory queries</div>
                    <div><i class="fas fa-clock text-warning"></i> Expiry tracking</div>
                    <div><i class="fas fa-bell text-danger"></i> Alert management</div>
                    <div><i class="fas fa-project-diagram text-purple"></i> DSA explanations</div>
                </div>
                <br>
                Try asking me something or click a quick question!
                <div class="message-actions">
                    <button class="action-btn code" onclick="showCodeExample('stack')">
                        <i class="fas fa-code"></i> Stack Code
                    </button>
                    <button class="action-btn demo" onclick="demoDSAOperation('stack')">
                        <i class="fas fa-play"></i> Stack Demo
                    </button>
                    <button class="action-btn info" onclick="askQuestion('What is time complexity?')">
                        <i class="fas fa-info-circle"></i> Time Complexity
                    </button>
                </div>
                <span class="message-time">Just now</span>
            `;
            
            const container = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            messageDiv.innerHTML = welcomeHTML;
            container.appendChild(messageDiv);
        }
        
        function loadQueryHistory() {
            const savedQueries = localStorage.getItem('expirysync_query_history');
            if (savedQueries) {
                try {
                    queryHistory = JSON.parse(savedQueries);
                    updateHistoryList();
                } catch (e) {
                    console.error('Error loading query history:', e);
                    queryHistory = [];
                }
            }
        }
        
        function setupTextArea() {
            const textarea = document.getElementById('chat-input');
            const charCount = document.getElementById('char-count');
            
            textarea.addEventListener('input', function() {
                charCount.textContent = this.value.length;
                
                // Auto-resize
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
                
                // Show/hide suggestions based on input
                updateSuggestions(this.value);
            });
        }
        
        function initVoiceRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('chat-input').value = transcript;
                    sendMessage();
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    showNotification('Voice recognition failed: ' + event.error, 'error');
                };
            } else {
                document.getElementById('voice-btn').style.display = 'none';
            }
        }
        
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (!message || isProcessing) return;
            
            // Add user message
            addMessageToUI(message, 'user');
            
            // Add to query history
            addToHistory(message);
            
            // Clear input
            input.value = '';
            input.style.height = 'auto';
            document.getElementById('char-count').textContent = '0';
            
            // Hide suggestions
            hideSuggestions();
            
            // Show typing indicator
            showTypingIndicator();
            
            // Process the question
            setTimeout(() => {
                processQuestion(message);
                hideTypingIndicator();
            }, 800 + Math.random() * 800);
        }
        
        function askQuestion(question) {
            const input = document.getElementById('chat-input');
            input.value = question;
            input.focus();
            sendMessage();
        }
        
        function processQuestion(question) {
            isProcessing = true;
            
            // Convert to lowercase for easier matching
            const query = question.toLowerCase();
            
            // Add to query history
            addToHistory(question);
            
            // Log DSA operation
            storage.logDSAOperation('AI', 'QUERY_PROCESSING', `Processing query: ${question.substring(0, 50)}...`);
            
            // Check query type and respond accordingly
            let response = '';
            let isDSA = false;
            let messageType = 'bot';
            
            try {
                if (query.includes('expir') && (query.includes('week') || query.includes('7 days') || query.includes('soon'))) {
                    response = generateExpiringResponse();
                } else if (query.includes('low stock') || query.includes('low in stock') || query.includes('restock')) {
                    response = generateLowStockResponse();
                } else if (query.includes('urgent') || query.includes('priority') || query.includes('most important')) {
                    response = generateUrgentResponse();
                } else if (query.includes('dairy') || query.includes('category') || query.includes('type')) {
                    response = generateCategoryResponse(query);
                } else if (query.includes('discount') || query.includes('sale') || query.includes('markdown')) {
                    response = generateDiscountResponse();
                } else if (query.includes('recent') || query.includes('new') || query.includes('added') || query.includes('last')) {
                    response = generateRecentResponse();
                } else if (query.includes('total') || query.includes('count') || query.includes('how many')) {
                    response = generateCountResponse();
                } else if (query.includes('stack') || query.includes('lifo') || query.includes('push') || query.includes('pop')) {
                    response = generateStackExplanation();
                    isDSA = true;
                } else if (query.includes('queue') || query.includes('fifo') || query.includes('enqueue') || query.includes('dequeue')) {
                    response = generateQueueExplanation();
                    isDSA = true;
                } else if (query.includes('priority queue') || query.includes('heap') || query.includes('min-heap')) {
                    response = generatePriorityQueueExplanation();
                    isDSA = true;
                } else if (query.includes('sort') || query.includes('algorithm') || query.includes('bubble') || query.includes('quick') || query.includes('merge')) {
                    response = generateSortingExplanation();
                    isDSA = true;
                } else if (query.includes('time complexity') || query.includes('big o') || query.includes('o(')) {
                    response = generateComplexityExplanation();
                    isDSA = true;
                } else if (query.includes('search') || query.includes('find') || query.includes('lookup')) {
                    response = generateSearchExplanation();
                    isDSA = true;
                } else if (query.includes('help') || query.includes('what can you do') || query.includes('capabilities')) {
                    response = generateHelpResponse();
                } else if (query.includes('hello') || query.includes('hi') || query.includes('hey') || query.includes('greetings')) {
                    response = generateGreetingResponse();
                } else {
                    response = generateGeneralResponse(question);
                }
                
                // Add the response to chat
                addMessageToUI(response, 'bot', isDSA);
                
                // Save chat history
                saveChatHistory();
                
                // Show related suggestions
                showRelatedSuggestions(query);
                
            } catch (error) {
                console.error('Error processing question:', error);
                response = `<strong>‚ö†Ô∏è Error:</strong> I encountered an error while processing your question. Please try again.<br><br>
                           <em>Technical details:</em> ${error.message}`;
                addMessageToUI(response, 'bot', false, 'error');
            }
            
            isProcessing = false;
        }
        
        function generateExpiringResponse() {
            const products = storage.getProducts();
            const today = new Date();
            const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
            
            const expiringProducts = products.filter(p => {
                const expiry = new Date(p.expiryDate);
                return expiry > today && expiry <= nextWeek;
            }).sort((a, b) => new Date(a.expiryDate) - new Date(b.expiryDate));
            
            let response = `<strong>üìÖ Products Expiring This Week (${expiringProducts.length} found):</strong><br><br>`;
            
            if (expiringProducts.length > 0) {
                response += `<div class="product-list">`;
                expiringProducts.forEach((product, index) => {
                    const daysLeft = calculateDaysUntilExpiry(product.expiryDate);
                    response += `
                        <div class="product-item">
                            <div class="product-item-info">
                                <div class="product-item-name">${product.productName}</div>
                                <div class="product-item-meta">
                                    <span>${product.category}</span>
                                    <span>${product.quantity} units</span>
                                    <span>${daysLeft} days left</span>
                                </div>
                            </div>
                            <div class="product-item-priority priority-${product.priority}">
                                ${product.priority}
                            </div>
                        </div>
                    `;
                });
                response += `</div>`;
                
                response += `<br><strong>üí° DSA Operations Used:</strong><br>`;
                response += `‚Ä¢ <span class="complexity-badge badge-On">Array filtering (O(n))</span> to find expiring products<br>`;
                response += `‚Ä¢ <span class="complexity-badge badge-Ologn">Sorting (O(n log n))</span> by expiry date<br>`;
                response += `‚Ä¢ Priority calculation for alerts`;
                
                response += `<div class="message-actions">
                    <button class="action-btn info" onclick="window.location.href='alerts.html'">
                        <i class="fas fa-bell"></i> View Alerts
                    </button>
                    <button class="action-btn copy" onclick="copyToClipboard('Expiring products list')">
                        <i class="fas fa-copy"></i> Copy List
                    </button>
                </div>`;
            } else {
                response = `üéâ <strong>Great news!</strong> No products are expiring in the next 7 days.`;
                messageType = 'success';
            }
            
            return response;
        }
        
        function generateLowStockResponse() {
            const products = storage.getProducts();
            const lowStockProducts = products.filter(p => p.quantity < 10);
            
            let response = `<strong>‚ö†Ô∏è Low Stock Items (Quantity < 10):</strong><br><br>`;
            
            if (lowStockProducts.length > 0) {
                response += `Found <strong>${lowStockProducts.length}</strong> products with low stock:<br><br>`;
                response += `<div class="product-list">`;
                
                lowStockProducts.forEach((product, index) => {
                    response += `
                        <div class="product-item">
                            <div class="product-item-info">
                                <div class="product-item-name">${product.productName}</div>
                                <div class="product-item-meta">
                                    <span>${product.category}</span>
                                    <span>${product.quantity} units</span>
                                    <span>Reorder: ${Math.max(0, 20 - product.quantity)}</span>
                                </div>
                            </div>
                            <div class="product-item-priority priority-${product.priority}">
                                ${product.priority}
                            </div>
                        </div>
                    `;
                });
                response += `</div>`;
                
                response += `<br><strong>üìä Recommendations:</strong><br>`;
                response += `‚Ä¢ Consider ordering more stock for these items<br>`;
                response += `‚Ä¢ Set up automatic reorder alerts<br>`;
                response += `‚Ä¢ Check supplier lead times`;
                
                response += `<div class="message-actions">
                    <button class="action-btn info" onclick="askQuestion('Which suppliers do we use?')">
                        <i class="fas fa-truck"></i> Supplier Info
                    </button>
                </div>`;
            } else {
                response = `‚úÖ <strong>Stock levels are good!</strong> All products have sufficient inventory.`;
                messageType = 'success';
            }
            
            return response;
        }
        
        function generateUrgentResponse() {
            const products = storage.getProducts();
            const today = new Date();
            
            // Find the most urgent product (highest priority = lowest number)
            let mostUrgent = null;
            let minPriority = Infinity;
            
            products.forEach(product => {
                if (product.priority < minPriority) {
                    minPriority = product.priority;
                    mostUrgent = product;
                }
            });
            
            let response = `<strong>üö® Most Urgent Product:</strong><br><br>`;
            
            if (mostUrgent) {
                const daysLeft = calculateDaysUntilExpiry(mostUrgent.expiryDate);
                const priorityText = getPriorityText(mostUrgent.priority);
                
                response += `
                    <div style="background: ${getPriorityColor(mostUrgent.priority)}10; padding: 15px; border-radius: 8px; border-left: 4px solid ${getPriorityColor(mostUrgent.priority)};">
                        <div style="font-size: 1.2rem; font-weight: bold; margin-bottom: 10px;">
                            ${mostUrgent.productName}
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 0.9rem;">
                            <div><strong>Category:</strong> ${mostUrgent.category}</div>
                            <div><strong>Quantity:</strong> ${mostUrgent.quantity} units</div>
                            <div><strong>Expiry:</strong> ${new Date(mostUrgent.expiryDate).toLocaleDateString()}</div>
                            <div><strong>Days Left:</strong> ${daysLeft}</div>
                            <div><strong>Priority:</strong> ${mostUrgent.priority} (${priorityText})</div>
                            <div><strong>Status:</strong> ${getStatusText(mostUrgent, daysLeft)}</div>
                        </div>
                    </div>
                `;
                
                response += `<br><strong>üìã Recommended Actions:</strong><br>`;
                
                if (mostUrgent.priority === 0) {
                    response += `‚Ä¢ ‚ö†Ô∏è <strong>IMMEDIATE ACTION:</strong> This product has expired!<br>`;
                    response += `‚Ä¢ Remove from sale immediately<br>`;
                    response += `‚Ä¢ Apply 50% discount for quick disposal<br>`;
                    response += `‚Ä¢ Update inventory records`;
                } else if (mostUrgent.priority <= 2) {
                    response += `‚Ä¢ Apply ${mostUrgent.priority === 1 ? '40%' : '30%'} discount<br>`;
                    response += `‚Ä¢ Move to front of store<br>`;
                    response += `‚Ä¢ Feature in promotions<br>`;
                    response += `‚Ä¢ Notify staff for priority sale`;
                } else {
                    response += `‚Ä¢ Monitor regularly<br>`;
                    response += `‚Ä¢ Consider small discount (10-20%)<br>`;
                    response += `‚Ä¢ Plan for future restocking`;
                }
                
                response += `<div class="message-actions">
                    <button class="action-btn demo" onclick="applyDiscount('${mostUrgent.id}')">
                        <i class="fas fa-percentage"></i> Apply Discount
                    </button>
                    <button class="action-btn info" onclick="viewProduct('${mostUrgent.id}')">
                        <i class="fas fa-eye"></i> View Details
                    </button>
                </div>`;
            } else {
                response = `‚úÖ <strong>No urgent products found.</strong> All inventory is in good condition.`;
                messageType = 'success';
            }
            
            return response;
        }
        
        function generateCategoryResponse(query) {
            const products = storage.getProducts();
            let category = 'all';
            
            // Extract category from query
            const categories = ['dairy', 'bakery', 'beverages', 'fruits', 'vegetables', 'meat', 'canned', 'snacks', 'cleaning'];
            categories.forEach(cat => {
                if (query.includes(cat)) {
                    category = cat;
                }
            });
            
            let filteredProducts = products;
            let categoryName = 'All Categories';
            
            if (category !== 'all') {
                filteredProducts = products.filter(p => 
                    p.category.toLowerCase().includes(category)
                );
                categoryName = category.charAt(0).toUpperCase() + category.slice(1);
            }
            
            let response = `<strong>üì¶ ${categoryName} Products (${filteredProducts.length} found):</strong><br><br>`;
            
            if (filteredProducts.length > 0) {
                // Show summary
                const expiredCount = filteredProducts.filter(p => {
                    const expiry = new Date(p.expiryDate);
                    return expiry < new Date();
                }).length;
                
                const expiringCount = filteredProducts.filter(p => {
                    const expiry = new Date(p.expiryDate);
                    const daysLeft = calculateDaysUntilExpiry(p.expiryDate);
                    return daysLeft > 0 && daysLeft <= 7;
                }).length;
                
                const lowStockCount = filteredProducts.filter(p => p.quantity < 10).length;
                
                response += `<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px;">
                    <div style="background: #fee; padding: 10px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 0.8rem; color: #c53030;">Expired</div>
                        <div style="font-size: 1.2rem; font-weight: bold; color: #c53030;">${expiredCount}</div>
                    </div>
                    <div style="background: #fef3cd; padding: 10px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 0.8rem; color: #92400e;">Expiring</div>
                        <div style="font-size: 1.2rem; font-weight: bold; color: #92400e;">${expiringCount}</div>
                    </div>
                    <div style="background: #dbeafe; padding: 10px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 0.8rem; color: #1e40af;">Low Stock</div>
                        <div style="font-size: 1.2rem; font-weight: bold; color: #1e40af;">${lowStockCount}</div>
                    </div>
                </div>`;
                
                // Show top 5 products
                const topProducts = filteredProducts.slice(0, 5);
                response += `<div class="product-list">`;
                topProducts.forEach(product => {
                    const daysLeft = calculateDaysUntilExpiry(product.expiryDate);
                    response += `
                        <div class="product-item">
                            <div class="product-item-info">
                                <div class="product-item-name">${product.productName}</div>
                                <div class="product-item-meta">
                                    <span>${product.quantity} units</span>
                                    <span>${daysLeft >= 0 ? `${daysLeft} days left` : 'Expired'}</span>
                                    <span>$${product.price || '0.00'}</span>
                                </div>
                            </div>
                            <div class="product-item-priority priority-${product.priority}">
                                ${product.priority}
                            </div>
                        </div>
                    `;
                });
                response += `</div>`;
                
                if (filteredProducts.length > 5) {
                    response += `<br><small>Showing 5 of ${filteredProducts.length} products. 
                               <button class="btn btn-xs btn-outline-primary" onclick="window.location.href='inventory.html?category=${category}'">
                                   View All
                               </button></small>`;
                }
                
                response += `<div class="message-actions">
                    <button class="action-btn info" onclick="askQuestion('Show me expiring ${category} products')">
                        <i class="fas fa-filter"></i> Filter Expiring
                    </button>
                </div>`;
            } else {
                response = `üì≠ <strong>No products found in ${categoryName}.</strong>`;
                if (category !== 'all') {
                    response += `<br>Try adding some ${category} products to your inventory.`;
                }
            }
            
            return response;
        }
        
        function generateDiscountResponse() {
            const products = storage.getProducts();
            const today = new Date();
            
            const discountProducts = products.filter(p => {
                const expiry = new Date(p.expiryDate);
                const daysLeft = calculateDaysUntilExpiry(p.expiryDate);
                return daysLeft <= 14 || p.quantity > 50; // Near expiry or overstocked
            }).sort((a, b) => {
                const daysA = calculateDaysUntilExpiry(a.expiryDate);
                const daysB = calculateDaysUntilExpiry(b.expiryDate);
                return daysA - daysB;
            });
            
            let response = `<strong>üí∞ Discount Suggestions:</strong><br><br>`;
            
            if (discountProducts.length > 0) {
                response += `Found <strong>${discountProducts.length}</strong> products that could benefit from discounts:<br><br>`;
                response += `<div class="product-list">`;
                
                discountProducts.slice(0, 5).forEach(product => {
                    const daysLeft = calculateDaysUntilExpiry(product.expiryDate);
                    const discount = getDiscountPercentage(daysLeft);
                    const currentPrice = product.price || 0;
                    const discountedPrice = currentPrice * (1 - discount/100);
                    
                    response += `
                        <div class="product-item">
                            <div class="product-item-info">
                                <div class="product-item-name">${product.productName}</div>
                                <div class="product-item-meta">
                                    <span>${daysLeft >= 0 ? `${daysLeft} days left` : 'Expired'}</span>
                                    <span>${discount}% discount</span>
                                    <span>$${currentPrice.toFixed(2)} ‚Üí $${discountedPrice.toFixed(2)}</span>
                                </div>
                            </div>
                            <div class="product-item-priority priority-${product.priority}">
                                ${product.priority}
                            </div>
                        </div>
                    `;
                });
                response += `</div>`;
                
                response += `<br><strong>üéØ Discount Strategy:</strong><br>`;
                response += `‚Ä¢ ‚â§3 days: 40-50% discount<br>`;
                response += `‚Ä¢ 4-7 days: 30% discount<br>`;
                response += `‚Ä¢ 8-14 days: 20% discount<br>`;
                response += `‚Ä¢ Expired: 50% discount (clearance)<br>`;
                response += `‚Ä¢ Overstock (>50 units): 15% discount`;
                
                response += `<div class="message-actions">
                    <button class="action-btn demo" onclick="applyAllDiscounts()">
                        <i class="fas fa-bolt"></i> Apply All
                    </button>
                    <button class="action-btn info" onclick="showDiscountStrategy()">
                        <i class="fas fa-chart-line"></i> Strategy Details
                    </button>
                </div>`;
            } else {
                response = `‚úÖ <strong>No discount recommendations needed.</strong><br>`;
                response += `All products have healthy expiry dates and appropriate stock levels.`;
                messageType = 'success';
            }
            
            return response;
        }
        
        function generateRecentResponse() {
            const recentProducts = storage.getRecentAdditions(5);
            
            let response = `<strong>üÜï Recent Product Additions (Stack - LIFO):</strong><br><br>`;
            
            if (recentProducts.length > 0) {
                response += `Showing <strong>${recentProducts.length}</strong> most recent additions (Last In, First Out):<br><br>`;
                response += `<div class="product-list">`;
                
                recentProducts.forEach((product, index) => {
                    const added = new Date(product.addedDate || product.createdDate);
                    const daysAgo = Math.floor((new Date() - added) / (1000 * 60 * 60 * 24));
                    
                    response += `
                        <div class="product-item">
                            <div class="product-item-info">
                                <div class="product-item-name">${product.productName}</div>
                                <div class="product-item-meta">
                                    <span>${product.category}</span>
                                    <span>${product.quantity} units</span>
                                    <span>Added ${daysAgo === 0 ? 'today' : `${daysAgo} days ago`}</span>
                                </div>
                            </div>
                            <div style="color: #666; font-size: 0.8rem;">
                                #${index + 1}
                            </div>
                        </div>
                    `;
                });
                response += `</div>`;
                
                response += `<br><strong>üìö DSA Concept: Stack (LIFO)</strong><br>`;
                response += `‚Ä¢ Most recent addition is at the "top" of the stack<br>`;
                response += `‚Ä¢ Operations: <span class="complexity-badge badge-O1">push()</span> to add, <span class="complexity-badge badge-O1">pop()</span> to remove<br>`;
                response += `‚Ä¢ Time complexity: O(1) for both operations`;
                
                response += `<div class="message-actions">
                    <button class="action-btn code" onclick="showCodeExample('stack')">
                        <i class="fas fa-code"></i> Stack Code
                    </button>
                    <button class="action-btn demo" onclick="demoDSAOperation('stack')">
                        <i class="fas fa-play"></i> Stack Demo
                    </button>
                </div>`;
            } else {
                response = `üì≠ <strong>No recent additions found.</strong><br>`;
                response += `Add some products to see them here!`;
            }
            
            return response;
        }
        
        function generateCountResponse() {
            const products = storage.getProducts();
            const totalProducts = products.length;
            const totalValue = products.reduce((sum, p) => sum + (p.price || 0) * p.quantity, 0);
            const totalQuantity = products.reduce((sum, p) => sum + p.quantity, 0);
            
            // Count by category
            const categoryCounts = {};
            products.forEach(p => {
                categoryCounts[p.category] = (categoryCounts[p.category] || 0) + 1;
            });
            
            let response = `<strong>üìä Inventory Summary:</strong><br><br>`;
            response += `<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                <div style="background: #ebf8ff; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 0.9rem; color: var(--primary);">Total Products</div>
                    <div style="font-size: 1.8rem; font-weight: bold; color: var(--primary);">${totalProducts}</div>
                </div>
                <div style="background: #f0fff4; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 0.9rem; color: var(--success);">Total Quantity</div>
                    <div style="font-size: 1.8rem; font-weight: bold; color: var(--success);">${totalQuantity}</div>
                </div>
                <div style="background: #fef3cd; padding: 15px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 0.9rem; color: var(--warning);">Total Value</div>
                    <div style="font-size: 1.8rem; font-weight: bold; color: var(--warning);">$${totalValue.toFixed(2)}</div>
                </div>
            </div>`;
            
            response += `<strong>üè∑Ô∏è Products by Category:</strong><br>`;
            response += `<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;">`;
            
            Object.entries(categoryCounts).forEach(([category, count]) => {
                const percentage = ((count / totalProducts) * 100).toFixed(1);
                response += `
                    <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: #f8f9fa; border-radius: 6px;">
                        <span>${category}</span>
                        <strong>${count} (${percentage}%)</strong>
                    </div>
                `;
            });
            
            response += `</div>`;
            
            // Add DSA operation info
            response += `<br><strong>üí° DSA Operations Used:</strong><br>`;
            response += `‚Ä¢ <span class="complexity-badge badge-On">Array traversal (O(n))</span> for counting<br>`;
            response += `‚Ä¢ <span class="complexity-badge badge-O1">Hash map lookup</span> for category counts`;
            
            return response;
        }
        
        function generateStackExplanation() {
            const codeExample = `
public class InventoryStack {
    private Stack<Product> productStack = new Stack<>();
    
    // Add product to stack (push operation)
    public void addProduct(Product product) {
        productStack.push(product); // O(1)
        System.out.println("Pushed: " + product.getName());
    }
    
    // Get most recent product (peek operation)
    public Product getRecentProduct() {
        return productStack.peek(); // O(1)
    }
    
    // Remove most recent product (pop operation)
    public Product removeRecentProduct() {
        return productStack.pop(); // O(1)
    }
}`;
            
            let response = `<strong>üìö Stack Data Structure (LIFO):</strong><br><br>`;
            response += `A Stack is a <strong>Last In, First Out (LIFO)</strong> data structure. Think of it like a stack of plates:<br><br>`;
            response += `‚Ä¢ Last plate added is first to be removed<br>`;
            response += `‚Ä¢ Operations: push(), pop(), peek()<br>`;
            response += `‚Ä¢ All operations have <span class="complexity-badge badge-O1">O(1)</span> time complexity<br><br>`;
            
            response += `<strong>In ExpirySync:</strong><br>`;
            response += `‚Ä¢ Recent products are stored in a stack<br>`;
            response += `‚Ä¢ Each new product is "pushed" to the stack<br>`;
            response += `‚Ä¢ The dashboard shows the top of the stack (most recent)<br><br>`;
            
            response += `<strong>üíª Java Implementation:</strong><br>`;
            response += `<div class="dsa-code-preview">${highlightCode(codeExample)}</div>`;
            
            response += `<div class="message-actions">
                <button class="action-btn demo" onclick="demoDSAOperation('stack')">
                    <i class="fas fa-play"></i> Demo Stack
                </button>
                <button class="action-btn copy" onclick="copyToClipboard('${codeExample.replace(/\n/g, '\\n')}')">
                    <i class="fas fa-copy"></i> Copy Code
                </button>
                <button class="action-btn info" onclick="askQuestion('Show me recent additions')">
                    <i class="fas fa-eye"></i> See in Action
                </button>
            </div>`;
            
            return response;
        }
        
        function generateQueueExplanation() {
            const codeExample = `
public class ExpiryQueue {
    private Queue<Product> expiryQueue = new LinkedList<>();
    
    // Add product to queue (enqueue)
    public void addToQueue(Product product) {
        expiryQueue.add(product); // O(1)
        System.out.println("Enqueued: " + product.getName());
    }
    
    // Process next expired product (dequeue)
    public Product processNextExpired() {
        return expiryQueue.poll(); // O(1)
    }
    
    // Check next without removing (peek)
    public Product getNextExpiring() {
        return expiryQueue.peek(); // O(1)
    }
}`;
            
            let response = `<strong>üìö Queue Data Structure (FIFO):</strong><br><br>`;
            response += `A Queue is a <strong>First In, First Out (FIFO)</strong> data structure. Think of it like a line of people:<br><br>`;
            response += `‚Ä¢ First person in line gets served first<br>`;
            response += `‚Ä¢ Operations: enqueue(), dequeue(), peek()<br>`;
            response += `‚Ä¢ All operations have <span class="complexity-badge badge-O1">O(1)</span> time complexity<br><br>`;
            
            response += `<strong>In ExpirySync:</strong><br>`;
            response += `‚Ä¢ Expiry alerts are processed in a queue<br>`;
            response += `‚Ä¢ First expired, first processed (FIFO)<br>`;
            response += `‚Ä¢ Ensures fair processing of alerts<br><br>`;
            
            response += `<strong>üíª Java Implementation:</strong><br>`;
            response += `<div class="dsa-code-preview">${highlightCode(codeExample)}</div>`;
            
            response += `<div class="message-actions">
                <button class="action-btn demo" onclick="demoDSAOperation('queue')">
                    <i class="fas fa-play"></i> Demo Queue
                </button>
                <button class="action-btn copy" onclick="copyToClipboard('${codeExample.replace(/\n/g, '\\n')}')">
                    <i class="fas fa-copy"></i> Copy Code
                </button>
                <button class="action-btn info" onclick="window.location.href='alerts.html'">
                    <i class="fas fa-external-link-alt"></i> View Queue
                </button>
            </div>`;
            
            return response;
        }
        
        function generatePriorityQueueExplanation() {
            const codeExample = `
public class PriorityExpiryQueue {
    // Min-heap: lower priority number = higher priority
    private PriorityQueue<Product> pq = new PriorityQueue<>(
        (a, b) -> a.getPriority() - b.getPriority()
    );
    
    // Add with priority (insert)
    public void addUrgentProduct(Product product) {
        pq.offer(product); // O(log n)
        System.out.println("Added with priority: " + product.getPriority());
    }
    
    // Get most urgent (peek)
    public Product getMostUrgent() {
        return pq.peek(); // O(1)
    }
    
    // Process most urgent (remove)
    public Product processMostUrgent() {
        return pq.poll(); // O(log n)
    }
}`;
            
            let response = `<strong>üìö Priority Queue (Min-Heap):</strong><br><br>`;
            response += `A Priority Queue is a special queue where elements have priorities. Implemented using a <strong>binary heap</strong>:<br><br>`;
            response += `‚Ä¢ Lower priority number = higher urgency<br>`;
            response += `‚Ä¢ Operations: insert(), remove(), peek()<br>`;
            response += `‚Ä¢ Insert/remove: <span class="complexity-badge badge-Ologn">O(log n)</span><br>`;
            response += `‚Ä¢ Peek: <span class="complexity-badge badge-O1">O(1)</span><br><br>`;
            
            response += `<strong>In ExpirySync:</strong><br>`;
            response += `‚Ä¢ Urgent alerts are managed in a priority queue<br>`;
            response += `‚Ä¢ Priority 0 (expired) is highest priority<br>`;
            response += `‚Ä¢ Ensures most urgent issues are handled first<br><br>`;
            
            response += `<strong>üíª Java Implementation:</strong><br>`;
            response += `<div class="dsa-code-preview">${highlightCode(codeExample)}</div>`;
            
            response += `<div class="message-actions">
                <button class="action-btn demo" onclick="demoDSAOperation('priority')">
                    <i class="fas fa-play"></i> Demo Priority Queue
                </button>
                <button class="action-btn copy" onclick="copyToClipboard('${codeExample.replace(/\n/g, '\\n')}')">
                    <i class="fas fa-copy"></i> Copy Code
                </button>
                <button class="action-btn info" onclick="askQuestion('What is the most urgent product?')">
                    <i class="fas fa-fire"></i> Find Urgent
                </button>
            </div>`;
            
            return response;
        }
        
        function generateSortingExplanation() {
            const quickSortExample = `
public void quickSortByExpiry(List<Product> products) {
    quickSort(products, 0, products.size() - 1);
}

private void quickSort(List<Product> products, int low, int high) {
    if (low < high) {
        int pi = partition(products, low, high);
        quickSort(products, low, pi - 1);
        quickSort(products, pi + 1, high);
    }
}

// Time Complexity: O(n log n) average, O(n¬≤) worst-case`;
            
            const bubbleSortExample = `
public void bubbleSortByQuantity(List<Product> products) {
    int n = products.size();
    for (int i = 0; i < n-1; i++) {
        for (int j = 0; j < n-i-1; j++) {
            if (products.get(j).getQuantity() > products.get(j+1).getQuantity()) {
                // Swap products[j] and products[j+1]
                Product temp = products.get(j);
                products.set(j, products.get(j+1));
                products.set(j+1, temp);
            }
        }
    }
}

// Time Complexity: O(n¬≤) always`;
            
            let response = `<strong>üìö Sorting Algorithms:</strong><br><br>`;
            response += `Sorting arranges data in a specific order. Different algorithms have different trade-offs:<br><br>`;
            
            response += `<table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
                <thead>
                    <tr style="background: #f8f9fa;">
                        <th style="padding: 8px; text-align: left; border-bottom: 2px solid #dee2e6;">Algorithm</th>
                        <th style="padding: 8px; text-align: left; border-bottom: 2px solid #dee2e6;">Best Case</th>
                        <th style="padding: 8px; text-align: left; border-bottom: 2px solid #dee2e6;">Average</th>
                        <th style="padding: 8px; text-align: left; border-bottom: 2px solid #dee2e6;">Worst Case</th>
                        <th style="padding: 8px; text-align: left; border-bottom: 2px solid #dee2e6;">Use Case</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">Quick Sort</td>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;"><span class="complexity-badge badge-Ologn">O(n log n)</span></td>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;"><span class="complexity-badge badge-Ologn">O(n log n)</span></td>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;"><span class="complexity-badge badge-On2">O(n¬≤)</span></td>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">General purpose</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">Merge Sort</td>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;"><span class="complexity-badge badge-Ologn">O(n log n)</span></td>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;"><span class="complexity-badge badge-Ologn">O(n log n)</span></td>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;"><span class="complexity-badge badge-Ologn">O(n log n)</span></td>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">Large datasets</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">Bubble Sort</td>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;"><span class="complexity-badge badge-On">O(n)</span></td>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;"><span class="complexity-badge badge-On2">O(n¬≤)</span></td>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;"><span class="complexity-badge badge-On2">O(n¬≤)</span></td>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">Educational/small data</td>
                    </tr>
                </tbody>
            </table>`;
            
            response += `<strong>In ExpirySync:</strong><br>`;
            response += `‚Ä¢ Products can be sorted by expiry date, priority, quantity, etc.<br>`;
            response += `‚Ä¢ Quick Sort is used for most sorting operations<br>`;
            response += `‚Ä¢ You can try different algorithms in the DSA Demo page<br><br>`;
            
            response += `<strong>üíª Quick Sort Example:</strong><br>`;
            response += `<div class="dsa-code-preview">${highlightCode(quickSortExample)}</div>`;
            
            response += `<strong>üíª Bubble Sort Example:</strong><br>`;
            response += `<div class="dsa-code-preview">${highlightCode(bubbleSortExample)}</div>`;
            
            response += `<div class="message-actions">
                <button class="action-btn demo" onclick="demoDSAOperation('sort')">
                    <i class="fas fa-play"></i> Demo Sorting
                </button>
                <button class="action-btn info" onclick="window.location.href='dsa-demo.html#sort-demo'">
                    <i class="fas fa-external-link-alt"></i> Interactive Demo
                </button>
            </div>`;
            
            return response;
        }
        
        function generateComplexityExplanation() {
            let response = `<strong>üìö Time Complexity (Big O Notation):</strong><br><br>`;
            response += `Big O notation describes how algorithm performance scales with input size:<br><br>`;
            
            response += `<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 15px 0;">
                <div style="background: #d1fae5; padding: 15px; border-radius: 8px;">
                    <div style="font-size: 1.2rem; font-weight: bold; color: #065f46;">O(1)</div>
                    <div style="font-size: 0.9rem;">Constant Time</div>
                    <div style="font-size: 0.8rem; margin-top: 5px;">‚Ä¢ Stack push/pop<br>‚Ä¢ Queue operations<br>‚Ä¢ Array access</div>
                </div>
                <div style="background: #fef3cd; padding: 15px; border-radius: 8px;">
                    <div style="font-size: 1.2rem; font-weight: bold; color: #92400e;">O(log n)</div>
                    <div style="font-size: 0.9rem;">Logarithmic Time</div>
                    <div style="font-size: 0.8rem; margin-top: 5px;">‚Ä¢ Binary search<br>‚Ä¢ Priority queue<br>‚Ä¢ Balanced trees</div>
                </div>
                <div style="background: #fee; padding: 15px; border-radius: 8px;">
                    <div style="font-size: 1.2rem; font-weight: bold; color: #991b1b;">O(n)</div>
                    <div style="font-size: 0.9rem;">Linear Time</div>
                    <div style="font-size: 0.8rem; margin-top: 5px;">‚Ä¢ Linear search<br>‚Ä¢ Array traversal<br>‚Ä¢ Counting items</div>
                </div>
                <div style="background: #e9d8fd; padding: 15px; border-radius: 8px;">
                    <div style="font-size: 1.2rem; font-weight: bold; color: #553c9a;">O(n¬≤)</div>
                    <div style="font-size: 0.9rem;">Quadratic Time</div>
                    <div style="font-size: 0.8rem; margin-top: 5px;">‚Ä¢ Bubble sort<br>‚Ä¢ Nested loops<br>‚Ä¢ Pair comparisons</div>
                </div>
            </div>`;
            
            response += `<strong>üìà Performance Comparison:</strong><br>`;
            response += `For n = 1000 items:<br>`;
            response += `‚Ä¢ O(1): 1 operation<br>`;
            response += `‚Ä¢ O(log n): ~10 operations<br>`;
            response += `‚Ä¢ O(n): 1000 operations<br>`;
            response += `‚Ä¢ O(n log n): ~10,000 operations<br>`;
            response += `‚Ä¢ O(n¬≤): 1,000,000 operations<br><br>`;
            
            response += `<strong>In ExpirySync:</strong><br>`;
            response += `‚Ä¢ Each DSA operation shows its time complexity<br>`;
            response += `‚Ä¢ Helps understand performance implications<br>`;
            response += `‚Ä¢ Guides algorithm selection for different tasks`;
            
            response += `<div class="message-actions">
                <button class="action-btn info" onclick="showComplexityChart()">
                    <i class="fas fa-chart-line"></i> View Chart
                </button>
                <button class="action-btn demo" onclick="runComplexityDemo()">
                    <i class="fas fa-rocket"></i> Run Demo
                </button>
            </div>`;
            
            return response;
        }
        
        function generateSearchExplanation() {
            const linearSearchExample = `
public Product linearSearchByName(List<Product> products, String name) {
    for (Product product : products) {
        if (product.getName().equals(name)) {
            return product; // Found!
        }
    }
    return null; // Not found
}
// Time Complexity: O(n)`;

            const binarySearchExample = `
public Product binarySearchByName(List<Product> products, String name) {
    // First sort by name (O(n log n))
    products.sort(Comparator.comparing(Product::getName));
    
    int left = 0, right = products.size() - 1;
    while (left <= right) {
        int mid = left + (right - left) / 2;
        int comparison = products.get(mid).getName().compareTo(name);
        
        if (comparison == 0) {
            return products.get(mid); // Found!
        } else if (comparison < 0) {
            left = mid + 1; // Search right half
        } else {
            right = mid - 1; // Search left half
        }
    }
    return null; // Not found
}
// Time Complexity: O(log n) after sorting`;
            
            let response = `<strong>üìö Searching Algorithms:</strong><br><br>`;
            response += `Searching finds specific items in a collection. Choice depends on data organization:<br><br>`;
            
            response += `<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin: 15px 0;">
                <div>
                    <strong>Linear Search</strong><br>
                    <span class="complexity-badge badge-On">O(n)</span><br>
                    ‚Ä¢ Works on unsorted data<br>
                    ‚Ä¢ Simple to implement<br>
                    ‚Ä¢ Checks each item sequentially<br>
                    ‚Ä¢ Good for small datasets
                </div>
                <div>
                    <strong>Binary Search</strong><br>
                    <span class="complexity-badge badge-Ologn">O(log n)</span><br>
                    ‚Ä¢ Requires sorted data<br>
                    ‚Ä¢ Much faster for large datasets<br>
                    ‚Ä¢ Divides search space in half<br>
                    ‚Ä¢ Needs O(n log n) sort first
                </div>
            </div>`;
            
            response += `<strong>üíª Linear Search Example:</strong><br>`;
            response += `<div class="dsa-code-preview">${highlightCode(linearSearchExample)}</div>`;
            
            response += `<strong>üíª Binary Search Example:</strong><br>`;
            response += `<div class="dsa-code-preview">${highlightCode(binarySearchExample)}</div>`;
            
            response += `<strong>In ExpirySync:</strong><br>`;
            response += `‚Ä¢ Product search uses linear search (unsorted data)<br>`;
            response += `‚Ä¢ If we sort by name first, could use binary search<br>`;
            response += `‚Ä¢ Trade-off: sort once, search many times`;
            
            response += `<div class="message-actions">
                <button class="action-btn demo" onclick="demoSearchAlgorithms()">
                    <i class="fas fa-search"></i> Demo Search
                </button>
                <button class="action-btn info" onclick="askQuestion('How do I find a specific product?')">
                    <i class="fas fa-question"></i> Search Help
                </button>
            </div>`;
            
            return response;
        }
        
        function generateHelpResponse() {
            let response = `<strong>ü§ñ ExpirySync AI Assistant - Help Guide</strong><br><br>`;
            
            response += `<strong>üéØ What I Can Do:</strong><br>`;
            response += `‚Ä¢ <strong>Inventory Management:</strong> Track products, expiry dates, stock levels<br>`;
            response += `‚Ä¢ <strong>Alert System:</strong> Get notified about expiring/low stock items<br>`;
            response += `‚Ä¢ <strong>DSA Explanations:</strong> Learn Stack, Queue, Priority Queue, Sorting<br>`;
            response += `‚Ä¢ <strong>Code Examples:</strong> See Java implementations<br>`;
            response += `‚Ä¢ <strong>Performance Analysis:</strong> Understand time complexity<br><br>`;
            
            response += `<strong>üí° Example Questions:</strong><br>`;
            response += `<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 10px 0;">
                <div style="background: #f8f9fa; padding: 10px; border-radius: 6px;">
                    <strong>Inventory:</strong><br>
                    ‚Ä¢ "Expiring this week?"<br>
                    ‚Ä¢ "Show low stock"<br>
                    ‚Ä¢ "Most urgent product"
                </div>
                <div style="background: #f8f9fa; padding: 10px; border-radius: 6px;">
                    <strong>DSA:</strong><br>
                    ‚Ä¢ "Explain Stack"<br>
                    ‚Ä¢ "What is Big O?"<br>
                    ‚Ä¢ "Show sorting code"
                </div>
            </div>`;
            
            response += `<strong>‚ö° Quick Tips:</strong><br>`;
            response += `‚Ä¢ Click quick questions in the sidebar<br>`;
            response += `‚Ä¢ Try DSA demos to see operations in action<br>`;
            response += `‚Ä¢ Check DSA Demo page for interactive visualizations<br>`;
            response += `‚Ä¢ All responses include time complexity info<br><br>`;
            
            response += `<strong>üîß Features:</strong><br>`;
            response += `‚Ä¢ <i class="fas fa-code"></i> Code syntax highlighting<br>`;
            response += `‚Ä¢ <i class="fas fa-copy"></i> Copy code to clipboard<br>`;
            response += `‚Ä¢ <i class="fas fa-microphone"></i> Voice input (if supported)<br>`;
            response += `‚Ä¢ <i class="fas fa-history"></i> Conversation history`;
            
            response += `<div class="message-actions">
                <button class="action-btn demo" onclick="showTutorial()">
                    <i class="fas fa-graduation-cap"></i> Start Tutorial
                </button>
                <button class="action-btn info" onclick="askQuestion('Show me all DSA structures')">
                    <i class="fas fa-project-diagram"></i> DSA Overview
                </button>
            </div>`;
            
            return response;
        }
        
        function generateGreetingResponse() {
            const greetings = [
                "Hello! üëã How can I help you with your inventory today?",
                "Hi there! Ready to manage your expiry dates?",
                "Greetings! I'm here to help with inventory and DSA concepts.",
                "Welcome back! What would you like to know about your inventory?",
                "Hey! Let's make inventory management easier together."
            ];
            
            const randomGreeting = greetings[Math.floor(Math.random() * greetings.length)];
            
            let response = `<strong>${randomGreeting}</strong><br><br>`;
            response += `I can help you with:<br>`;
            response += `‚Ä¢ Inventory tracking and alerts<br>`;
            response += `‚Ä¢ DSA structure explanations<br>`;
            response += `‚Ä¢ Code examples and demos<br>`;
            response += `‚Ä¢ Performance analysis<br><br>`;
            response += `Try asking a question or click a quick question in the sidebar!`;
            
            return response;
        }
        
        function generateGeneralResponse(question) {
            const responses = [
                `I understand you asked about "${question}". I specialize in inventory management and DSA concepts. Could you be more specific about what you'd like to know?`,
                `Thanks for your question! While I'm great at inventory queries and DSA explanations, I need more context. Try asking about expiring products, low stock, or specific data structures.`,
                `Interesting question! As an AI focused on inventory management with DSA, I can help with product tracking, expiry alerts, stock analysis, and data structure visualizations. What specifically would you like to know?`,
                `I'm your DSA-powered inventory assistant. For questions about "${question}", try rephrasing or ask about: inventory status, DSA operations, or code examples.`
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            
            let response = `<strong>${randomResponse}</strong><br><br>`;
            response += `<strong>üí° Try asking:</strong><br>`;
            response += `‚Ä¢ "Which products expire this week?"<br>`;
            response += `‚Ä¢ "Explain Stack data structure"<br>`;
            response += `‚Ä¢ "Show me low stock items"<br>`;
            response += `‚Ä¢ "What is time complexity?"`;
            
            return response;
        }
        
        function highlightCode(code) {
            return code
                .replace(/\b(public|private|class|void|return|new|if|else|for|while)\b/g, '<span class="keyword">$1</span>')
                .replace(/\b(int|String|boolean|List|Stack|Queue|Product)\b/g, '<span class="type">$1</span>')
                .replace(/"([^"]*)"/g, '<span class="string">"$1"</span>')
                .replace(/\b(\d+)\b/g, '<span class="number">$1</span>')
                .replace(/\/\/.*$/gm, '<span class="comment">$&</span>')
                .replace(/[{}();=<>+-\/*]/g, '<span class="operator">$&</span>');
        }
        
        // UI Functions
        function addMessageToUI(text, sender, isDSA = false, messageType = 'bot') {
            const container = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            
            let messageClass = `message ${sender}`;
            if (sender === 'bot') {
                if (isDSA) messageClass += ' dsa';
                if (messageType !== 'bot') messageClass += ` ${messageType}`;
            }
            
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.className = messageClass;
            messageDiv.innerHTML = `
                ${formatMessage(text, sender)}
                <span class="message-time">${time}</span>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
            
            // Add to chat history
            chatHistory.push({
                text: text,
                sender: sender,
                isDSA: isDSA,
                timestamp: new Date().toISOString()
            });
            
            // Limit history size
            if (chatHistory.length > 50) {
                chatHistory = chatHistory.slice(-50);
            }
            
            // Save history
            saveChatHistory();
        }
        
        function formatMessage(text, sender) {
            if (sender === 'user') {
                return `<strong>üë§ You:</strong><br>${escapeHtml(text)}`;
            } else {
                return text; // Already formatted with HTML
            }
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function showTypingIndicator() {
            document.getElementById('typing-indicator').style.display = 'flex';
            const container = document.getElementById('chat-messages');
            container.scrollTop = container.scrollHeight;
        }
        
        function hideTypingIndicator() {
            document.getElementById('typing-indicator').style.display = 'none';
        }
        
        function addToHistory(query) {
            queryHistory.unshift({
                query: query,
                timestamp: new Date().toISOString()
            });
            
            // Keep only last 20 queries
            if (queryHistory.length > 20) {
                queryHistory = queryHistory.slice(0, 20);
            }
            
            updateHistoryList();
            saveQueryHistory();
        }
        
        function updateHistoryList() {
            const container = document.getElementById('history-list');
            if (!container) return;
            
            if (queryHistory.length === 0) {
                container.innerHTML = '<div style="color: rgba(255,255,255,0.6); font-size: 0.85rem; text-align: center;">No recent queries</div>';
                return;
            }
            
            let html = '';
            queryHistory.slice(0, 5).forEach((item, index) => {
                const query = item.query.length > 30 ? item.query.substring(0, 27) + '...' : item.query;
                html += `
                    <div class="history-item" onclick="askQuestion('${item.query.replace(/'/g, "\\'")}')">
                        ${index + 1}. ${query}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function clearHistory() {
            if (confirm('Clear all chat history?')) {
                chatHistory = [];
                queryHistory = [];
                localStorage.removeItem('expirysync_chat_history');
                localStorage.removeItem('expirysync_query_history');
                
                // Reload chat
                loadChatHistory();
                updateHistoryList();
                
                showNotification('History cleared', 'success');
            }
        }
        
        function clearChat() {
            if (confirm('Clear current chat?')) {
                chatHistory = [];
                localStorage.removeItem('expirysync_chat_history');
                
                // Clear UI but keep welcome message
                const container = document.getElementById('chat-messages');
                container.innerHTML = '';
                addWelcomeMessage();
                
                showNotification('Chat cleared', 'success');
            }
        }
        
        function saveChatHistory() {
            localStorage.setItem('expirysync_chat_history', JSON.stringify(chatHistory));
        }
        
        function saveQueryHistory() {
            localStorage.setItem('expirysync_query_history', JSON.stringify(queryHistory));
        }
        
        // Voice Functions
        function toggleVoiceInput() {
            const voiceContainer = document.getElementById('voice-input-container');
            const voiceBtn = document.getElementById('voice-btn');
            
            if (voiceContainer.style.display === 'none' || !voiceContainer.style.display) {
                if (recognition) {
                    voiceContainer.style.display = 'block';
                    voiceBtn.innerHTML = '<i class="fas fa-microphone-slash"></i> Voice';
                    voiceBtn.classList.remove('btn-outline-success');
                    voiceBtn.classList.add('btn-success');
                    
                    // Start listening
                    recognition.start();
                    document.getElementById('voice-input').placeholder = 'Listening...';
                } else {
                    showNotification('Voice recognition not supported in your browser', 'error');
                }
            } else {
                voiceContainer.style.display = 'none';
                voiceBtn.innerHTML = '<i class="fas fa-microphone"></i> Voice';
                voiceBtn.classList.remove('btn-success');
                voiceBtn.classList.add('btn-outline-success');
                
                // Stop listening
                if (recognition) {
                    recognition.stop();
                }
            }
        }
        
        // Suggestion Functions
        function showWelcomeSuggestions() {
            const suggestions = [
                'Which products are expiring this week?',
                'Show me low stock items',
                'Explain Stack data structure',
                'What is the most urgent product?'
            ];
            
            showSuggestions(suggestions);
        }
        
        function showRelatedSuggestions(query) {
            let suggestions = [];
            const queryLower = query.toLowerCase();
            
            if (queryLower.includes('expir')) {
                suggestions = knowledgeBase.expiring;
            } else if (queryLower.includes('stock')) {
                suggestions = knowledgeBase.stock;
            } else if (queryLower.includes('categor')) {
                suggestions = knowledgeBase.category;
            } else if (queryLower.includes('stack') || queryLower.includes('queue') || queryLower.includes('priority') || queryLower.includes('sort')) {
                suggestions = knowledgeBase.dsa;
            } else if (queryLower.includes('recent')) {
                suggestions = knowledgeBase.recent;
            } else {
                // Default suggestions
                suggestions = [
                    'Show me expiring products',
                    'What is the most urgent item?',
                    'Explain Priority Queue',
                    'How many products total?'
                ];
            }
            
            showSuggestions(suggestions);
        }
        
        function showSuggestions(suggestions) {
            const container = document.getElementById('suggested-questions');
            if (!container) return;
            
            currentSuggestions = suggestions;
            
            let html = '<strong style="font-size: 0.9rem; color: #666; margin-right: 10px;">Try asking:</strong>';
            suggestions.forEach(suggestion => {
                html += `
                    <div class="suggested-question" onclick="askQuestion('${suggestion.replace(/'/g, "\\'")}')">
                        ${suggestion}
                    </div>
                `;
            });
            
            container.innerHTML = html;
            container.style.display = 'flex';
        }
        
        function hideSuggestions() {
            const container = document.getElementById('suggested-questions');
            if (container) {
                container.style.display = 'none';
            }
        }
        
        function updateSuggestions(input) {
            if (!input.trim()) {
                showWelcomeSuggestions();
                return;
            }
            
            const inputLower = input.toLowerCase();
            let matchedSuggestions = [];
            
            // Find suggestions containing input words
            Object.values(knowledgeBase).forEach(category => {
                category.forEach(suggestion => {
                    if (suggestion.toLowerCase().includes(inputLower) && !matchedSuggestions.includes(suggestion)) {
                        matchedSuggestions.push(suggestion);
                    }
                });
            });
            
            // If no matches, show default suggestions
            if (matchedSuggestions.length === 0) {
                matchedSuggestions = currentSuggestions;
            }
            
            // Limit to 4 suggestions
            matchedSuggestions = matchedSuggestions.slice(0, 4);
            
            if (matchedSuggestions.length > 0) {
                showSuggestions(matchedSuggestions);
            } else {
                hideSuggestions();
            }
        }
        
        // Utility Functions
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }
        
        function insertCodeTemplate() {
            const templates = [
                '// Stack implementation in Java\nclass Stack {\n  void push(Item item) { /* O(1) */ }\n  Item pop() { /* O(1) */ }\n}',
                '// Queue implementation\nclass Queue {\n  void enqueue(Item item) { /* O(1) */ }\n  Item dequeue() { /* O(1) */ }\n}',
                '// Priority Queue (Min-Heap)\nclass PriorityQueue {\n  void insert(Item item, int priority) { /* O(log n) */ }\n  Item remove() { /* O(log n) */ }\n}'
            ];
            
            const randomTemplate = templates[Math.floor(Math.random() * templates.length)];
            const input = document.getElementById('chat-input');
            input.value = randomTemplate;
            input.focus();
        }
        
        function showExamples() {
            const examples = [
                'Which products expire in the next 3 days?',
                'Show me all dairy products',
                'Explain time complexity O(n log n)',
                'How does a Stack work?',
                'What is the most urgent alert?'
            ];
            
            let response = `<strong>üí° Example Questions:</strong><br><br>`;
            examples.forEach((example, index) => {
                response += `${index + 1}. <button class="btn btn-xs btn-outline-primary" onclick="askQuestion('${example.replace(/'/g, "\\'")}')" style="margin: 2px;">${example}</button><br>`;
            });
            
            response += `<br>Click any example to ask it!`;
            
            addMessageToUI(response, 'bot');
        }
        
        function showCodeExample(structure) {
            let code = '';
            let title = '';
            
            switch(structure) {
                case 'stack':
                    title = 'Stack Implementation';
                    code = `public class InventoryStack {
    private Stack<Product> stack = new Stack<>();
    
    public void addProduct(Product p) {
        stack.push(p); // O(1)
    }
    
    public Product getRecent() {
        return stack.peek(); // O(1)
    }
}`;
                    break;
                case 'queue':
                    title = 'Queue Implementation';
                    code = `public class ExpiryQueue {
    private Queue<Product> queue = new LinkedList<>();
    
    public void addToQueue(Product p) {
        queue.add(p); // O(1)
    }
    
    public Product processNext() {
        return queue.poll(); // O(1)
    }
}`;
                    break;
            }
            
            let response = `<strong>üíª ${title}</strong><br>`;
            response += `<div class="dsa-code-preview">${highlightCode(code)}</div>`;
            response += `<div class="message-actions">
                <button class="action-btn copy" onclick="copyToClipboard('${code.replace(/\n/g, '\\n')}')">
                    <i class="fas fa-copy"></i> Copy Code
                </button>
                <button class="action-btn demo" onclick="demoDSAOperation('${structure}')">
                    <i class="fas fa-play"></i> Run Demo
                </button>
            </div>`;
            
            addMessageToUI(response, 'bot', true);
        }
        
        function demoDSAOperation(operation) {
            let demoHTML = '';
            
            switch(operation) {
                case 'stack':
                    demoHTML = `<strong>üéÆ Stack Demo (LIFO):</strong><br><br>`;
                    demoHTML += `Simulating Stack operations:<br>`;
                    demoHTML += `1. Push("Milk") <span class="complexity-badge badge-O1">O(1)</span><br>`;
                    demoHTML += `2. Push("Bread") <span class="complexity-badge badge-O1">O(1)</span><br>`;
                    demoHTML += `3. Push("Eggs") <span class="complexity-badge badge-O1">O(1)</span><br>`;
                    demoHTML += `4. Pop() ‚Üí "Eggs" <span class="complexity-badge badge-O1">O(1)</span><br>`;
                    demoHTML += `5. Peek() ‚Üí "Bread" <span class="complexity-badge badge-O1">O(1)</span><br><br>`;
                    demoHTML += `<strong>Last In, First Out:</strong> The last item added ("Eggs") is the first one removed.`;
                    break;
                    
                case 'queue':
                    demoHTML = `<strong>üéÆ Queue Demo (FIFO):</strong><br><br>`;
                    demoHTML += `Simulating Queue operations:<br>`;
                    demoHTML += `1. Enqueue("Alert1") <span class="complexity-badge badge-O1">O(1)</span><br>`;
                    demoHTML += `2. Enqueue("Alert2") <span class="complexity-badge badge-O1">O(1)</span><br>`;
                    demoHTML += `3. Enqueue("Alert3") <span class="complexity-badge badge-O1">O(1)</span><br>`;
                    demoHTML += `4. Dequeue() ‚Üí "Alert1" <span class="complexity-badge badge-O1">O(1)</span><br>`;
                    demoHTML += `5. Dequeue() ‚Üí "Alert2" <span class="complexity-badge badge-O1">O(1)</span><br><br>`;
                    demoHTML += `<strong>First In, First Out:</strong> The first item added is the first one processed.`;
                    break;
                    
                case 'priority':
                    demoHTML = `<strong>üéÆ Priority Queue Demo:</strong><br><br>`;
                    demoHTML += `Simulating Priority Queue operations:<br>`;
                    demoHTML += `1. Insert("Expired", priority=0) <span class="complexity-badge badge-Ologn">O(log n)</span><br>`;
                    demoHTML += `2. Insert("Expiring", priority=1) <span class="complexity-badge badge-Ologn">O(log n)</span><br>`;
                    demoHTML += `3. Insert("LowStock", priority=3) <span class="complexity-badge badge-Ologn">O(log n)</span><br>`;
                    demoHTML += `4. Remove() ‚Üí "Expired" <span class="complexity-badge badge-Ologn">O(log n)</span><br>`;
                    demoHTML += `5. Peek() ‚Üí "Expiring" <span class="complexity-badge badge-O1">O(1)</span><br><br>`;
                    demoHTML += `<strong>Priority-based:</strong> Lower priority number = higher urgency.`;
                    break;
                    
                case 'sort':
                    demoHTML = `<strong>üéÆ Sorting Demo:</strong><br><br>`;
                    demoHTML += `Comparing sorting algorithms for 1000 products:<br>`;
                    demoHTML += `‚Ä¢ Quick Sort: <span class="complexity-badge badge-Ologn">~10,000 operations</span><br>`;
                    demoHTML += `‚Ä¢ Merge Sort: <span class="complexity-badge badge-Ologn">~10,000 operations</span><br>`;
                    demoHTML += `‚Ä¢ Bubble Sort: <span class="complexity-badge badge-On2">~1,000,000 operations</span><br><br>`;
                    demoHTML += `<strong>Result:</strong> Quick/Merge Sort are 100x faster than Bubble Sort!`;
                    break;
            }
            
            addMessageToUI(demoHTML, 'bot', true);
            
            // Log DSA operation
            storage.logDSAOperation('DEMO', operation.toUpperCase(), `Demoed ${operation} operations`);
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('Copied to clipboard!', 'success');
            }).catch(err => {
                console.error('Copy failed:', err);
                showNotification('Copy failed', 'error');
            });
        }
        
        function showComplexityChart() {
            const response = `<strong>üìà Time Complexity Chart:</strong><br><br>`;
            response += `<div style="text-align: center; margin: 15px 0;">
                <div style="display: inline-block; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                    <div style="font-size: 0.9rem; margin-bottom: 10px;">Operations for n=1000 items:</div>
                    <div style="display: flex; align-items: flex-end; height: 200px; gap: 20px; justify-content: center;">
                        <div style="display: flex; flex-direction: column; align-items: center;">
                            <div style="background: #10B981; width: 30px; height: 20px;"></div>
                            <div style="margin-top: 5px;">O(1)<br>1</div>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center;">
                            <div style="background: #F59E0B; width: 30px; height: 40px;"></div>
                            <div style="margin-top: 5px;">O(log n)<br>10</div>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center;">
                            <div style="background: #EF4444; width: 30px; height: 200px;"></div>
                            <div style="margin-top: 5px;">O(n)<br>1000</div>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center;">
                            <div style="background: #8B5CF6; width: 30px; height: 400px;"></div>
                            <div style="margin-top: 5px;">O(n¬≤)<br>1M</div>
                        </div>
                    </div>
                </div>
            </div>`;
            
            addMessageToUI(response, 'bot', true);
        }
        
        function runComplexityDemo() {
            const n = 1000;
            const results = {
                'O(1)': 1,
                'O(log n)': Math.floor(Math.log2(n)),
                'O(n)': n,
                'O(n log n)': n * Math.floor(Math.log2(n)),
                'O(n¬≤)': n * n
            };
            
            let response = `<strong>‚ö° Time Complexity Demo:</strong><br><br>`;
            response += `For n = ${n} items:<br><br>`;
            
            Object.entries(results).forEach(([complexity, ops]) => {
                response += `‚Ä¢ ${complexity}: ${ops.toLocaleString()} operations<br>`;
            });
            
            response += `<br><strong>üí° Key Insight:</strong><br>`;
            response += `O(n¬≤) is ${(results['O(n¬≤)'] / results['O(n log n)']).toFixed(0)}x slower than O(n log n)!`;
            
            addMessageToUI(response, 'bot', true);
        }
        
        function demoSearchAlgorithms() {
            const n = 1000;
            const linearOps = n;
            const binaryOps = Math.floor(Math.log2(n));
            const sortOps = n * Math.floor(Math.log2(n));
            
            let response = `<strong>üîç Search Algorithm Comparison:</strong><br><br>`;
            response += `For ${n} unsorted products:<br><br>`;
            response += `<strong>Linear Search:</strong><br>`;
            response += `‚Ä¢ Operations: ${linearOps.toLocaleString()} <span class="complexity-badge badge-On">O(n)</span><br>`;
            response += `‚Ä¢ Simple, works immediately<br><br>`;
            
            response += `<strong>Binary Search (after sorting):</strong><br>`;
            response += `‚Ä¢ Sort operations: ${sortOps.toLocaleString()} <span class="complexity-badge badge-Ologn">O(n log n)</span><br>`;
            response += `‚Ä¢ Search operations: ${binaryOps} <span class="complexity-badge badge-Ologn">O(log n)</span><br>`;
            response += `‚Ä¢ Total for first search: ${(sortOps + binaryOps).toLocaleString()}<br><br>`;
            
            response += `<strong>Recommendation:</strong><br>`;
            response += `‚Ä¢ Use Linear Search for occasional searches<br>`;
            response += `‚Ä¢ Use Binary Search if searching many times`;
            
            addMessageToUI(response, 'bot', true);
        }
        
        function showTutorial() {
            const tutorial = `<strong>üéì ExpirySync AI Tutorial</strong><br><br>`;
            tutorial += `Welcome to the interactive tutorial! Let's explore:<br><br>`;
            tutorial += `1. <strong>Inventory Queries</strong><br>`;
            tutorial += `   ‚Ä¢ Ask about expiring products<br>`;
            tutorial += `   ‚Ä¢ Check stock levels<br>`;
            tutorial += `   ‚Ä¢ Get category counts<br><br>`;
            tutorial += `2. <strong>DSA Concepts</strong><br>`;
            tutorial += `   ‚Ä¢ Learn Stack, Queue, Priority Queue<br>`;
            tutorial += `   ‚Ä¢ Understand time complexity<br>`;
            tutorial += `   ‚Ä¢ See code examples<br><br>`;
            tutorial += `3. <strong>Features</strong><br>`;
            tutorial += `   ‚Ä¢ Voice input (if supported)<br>`;
            tutorial += `   ‚Ä¢ Code copying<br>`;
            tutorial += `   ‚Ä¢ Interactive demos<br><br>`;
            tutorial += `<strong>Try these now:</strong><br>`;
            tutorial += `‚Ä¢ "What expires this week?"<br>`;
            tutorial += `‚Ä¢ "Explain Stack"<br>`;
            tutorial += `‚Ä¢ "Show me low stock"`;
            
            addMessageToUI(tutorial, 'bot');
        }
        
        function showDiscountStrategy() {
            const strategy = `<strong>üéØ Discount Strategy Details</strong><br><br>`;
            strategy += `<strong>Tiered Discount Approach:</strong><br>`;
            strategy += `<table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
                <thead>
                    <tr style="background: #f8f9fa;">
                        <th style="padding: 8px; text-align: left; border-bottom: 2px solid #dee2e6;">Days Until Expiry</th>
                        <th style="padding: 8px; text-align: left; border-bottom: 2px solid #dee2e6;">Discount</th>
                        <th style="padding: 8px; text-align: left; border-bottom: 2px solid #dee2e6;">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">Expired</td>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">50%</td>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">Immediate removal</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">‚â§3 days</td>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">40%</td>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">Priority promotion</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">4-7 days</td>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">30%</td>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">Feature in ads</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">8-14 days</td>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">20%</td>
                        <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">Monitor closely</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px;">>14 days</td>
                        <td style="padding: 8px;">0-15%</td>
                        <td style="padding: 8px;">Normal sales</td>
                    </tr>
                </tbody>
            </table>`;
            
            strategy += `<strong>üìä Benefits:</strong><br>`;
            strategy += `‚Ä¢ Reduces waste by 60-80%<br>`;
            strategy += `‚Ä¢ Increases revenue from near-expiry items<br>`;
            strategy += `‚Ä¢ Maintains customer trust<br>`;
            strategy += `‚Ä¢ Optimizes inventory turnover`;
            
            addMessageToUI(strategy, 'bot');
        }
        
        // Helper Functions
        function calculateDaysUntilExpiry(expiryDate) {
            const today = new Date();
            const expiry = new Date(expiryDate);
            return Math.ceil((expiry - today) / (1000 * 60 * 60 * 24));
        }
        
        function getDiscountPercentage(daysUntilExpiry) {
            if (daysUntilExpiry < 0) return 50;
            if (daysUntilExpiry <= 3) return 40;
            if (daysUntilExpiry <= 7) return 30;
            if (daysUntilExpiry <= 14) return 20;
            if (daysUntilExpiry <= 30) return 10;
            return 0;
        }
        
        function getPriorityText(priority) {
            switch(priority) {
                case 0: return 'Expired (Highest)';
                case 1: return 'Critical (‚â§3 days)';
                case 2: return 'High (4-7 days)';
                case 3: return 'Medium (Low Stock)';
                case 4: return 'Low (Healthy)';
                default: return 'Unknown';
            }
        }
        
        function getPriorityColor(priority) {
            switch(priority) {
                case 0: return '#ef4444';
                case 1: return '#f97316';
                case 2: return '#f59e0b';
                case 3: return '#3b82f6';
                case 4: return '#10b981';
                default: return '#6b7280';
            }
        }
        
        function getStatusText(product, daysLeft) {
            if (daysLeft < 0) return 'Expired';
            if (daysLeft <= 3) return 'Critical';
            if (daysLeft <= 7) return 'Urgent';
            if (product.quantity < 10) return 'Low Stock';
            return 'Healthy';
        }
        
        function applyDiscount(productId) {
            // This would normally update the product
            showNotification('Discount applied to product', 'success');
            storage.logDSAOperation('DISCOUNT', 'APPLY', `Applied discount to product ${productId}`);
        }
        
        function applyAllDiscounts() {
            showNotification('Discounts applied to all eligible products', 'success');
            storage.logDSAOperation('DISCOUNT', 'BULK_APPLY', 'Applied discounts to multiple products');
        }
        
        function viewProduct(productId) {
            // This would normally navigate to product view
            showNotification(`Viewing product ${productId}`, 'info');
        }
        
        function showHelp() {
            generateHelpResponse();
            const response = generateHelpResponse();
            addMessageToUI(response, 'bot');
        }
        
        function showNotification(message, type) {
            const icon = type === 'success' ? 'fa-check-circle' : 
                        type === 'error' ? 'fa-exclamation-circle' : 
                        type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle';
            const color = type === 'success' ? '#155724' : 
                         type === 'error' ? '#721c24' : 
                         type === 'warning' ? '#856404' : '#0c5460';
            const bgColor = type === 'success' ? '#d4edda' : 
                           type === 'error' ? '#f8d7da' : 
                           type === 'warning' ? '#fff3cd' : '#d1ecf1';
            
            const notification = document.createElement('div');
            notification.innerHTML = `
                <i class="fas ${icon}"></i>
                <span>${message}</span>
            `;
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${bgColor};
                color: ${color};
                padding: 12px 18px;
                border-radius: 8px;
                display: flex;
                align-items: center;
                gap: 10px;
                z-index: 9999;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                animation: slideIn 0.3s ease;
                max-width: 400px;
                font-size: 0.9rem;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // Add animation styles
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>